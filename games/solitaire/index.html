<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Solitaire Zen | MicFri Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;600;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-table: #d0d7e4;
            --card-front: rgba(255, 255, 255, 0.9);
            --card-back: linear-gradient(135deg, #b4c8fa 0%, #8fd3f4 100%);
            --text-dark: #1a202c;
            --text-red: #ff4d4d;
            --accent: #84fab0;
        }

        body {
            margin: 0;
            background: radial-gradient(circle at 50% 50%, #f0f4f8 0%, #d0d7e4 100%);
            font-family: 'Outfit', sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- INTERFACE --- */
        .game-header {
            padding: 20px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .game-container {
            flex-grow: 1;
            width: 95%;
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .top-row { display: flex; gap: 20px; height: 160px; }
        .tableau-piles { display: flex; gap: 20px; flex-grow: 1; }

        /* --- CARTES --- */
        .card-placeholder {
            width: 110px;
            height: 155px;
            border-radius: 15px;
            background: rgba(255,255,255,0.2);
            border: 2px dashed rgba(0,0,0,0.05);
            position: relative;
        }

        .card {
            width: 110px;
            height: 155px;
            border-radius: 15px;
            position: absolute;
            background: var(--card-front);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            padding: 10px;
            box-sizing: border-box;
            cursor: grab;
            transition: transform 0.2s;
            border: 1px solid rgba(255,255,255,0.8);
        }

        .card-back {
            background: var(--card-back);
            background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 2l8 16H2L10 2z' fill='white' opacity='0.1'/%3E%3C/svg%3E");
        }

        .red { color: var(--text-red); }
        .black { color: var(--text-dark); }

        .card-value { font-weight: 900; font-size: 1.2rem; }
        .card-suit { font-size: 1rem; }
        .card-center-suit { 
            position: absolute; top: 50%; left: 50%; 
            transform: translate(-50%, -50%); 
            font-size: 2.5rem; opacity: 0.15; 
        }

        /* --- FOOTER & BOUTONS --- */
        footer {
            padding: 20px;
            text-align: center;
            font-size: 0.8rem;
            background: rgba(255,255,255,0.4);
            backdrop-filter: blur(10px);
        }

        .btn {
            background: white;
            border: none;
            padding: 10px 20px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            transition: 0.3s;
        }

        .btn:hover { transform: translateY(-2px); background: var(--accent); }

    </style>
</head>
<body>

    <header class="game-header">
        <a href="../../index.html" class="btn">← Menu</a>
        <div style="font-weight: 900; letter-spacing: 2px;">SOLITAIRE <span style="color:var(--text-red)">ZEN</span></div>
        <button class="btn" id="new-game-button">Nouvelle Partie</button>
    </header>

    <div class="game-container">
        <div class="top-row">
            <div id="stock-pile" class="card-placeholder"></div>
            <div id="waste-pile" class="card-placeholder"></div>
            <div style="flex-grow: 1;"></div>
            <div id="foundation-piles" style="display:flex; gap:20px;"></div>
        </div>

        <div class="tableau-piles">
            <div class="tableau-pile card-placeholder" id="pile-0"></div>
            <div class="tableau-pile card-placeholder" id="pile-1"></div>
            <div class="tableau-pile card-placeholder" id="pile-2"></div>
            <div class="tableau-pile card-placeholder" id="pile-3"></div>
            <div class="tableau-pile card-placeholder" id="pile-4"></div>
            <div class="tableau-pile card-placeholder" id="pile-5"></div>
            <div class="tableau-pile card-placeholder" id="pile-6"></div>
        </div>
    </div>

    <footer>
        <div>&copy; 2026 TESLAGAME OS • DEVELOPED BY <b>MICFRI</b></div>
    </footer>

    <script>
        const suits = ['♠', '♣', '♥', '♦'];
        const values = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
        const valueMap = { 'A': 1, '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10, 'J': 11, 'Q': 12, 'K': 13 };

        let stockPile = [], wastePile = [], tableauPiles = [], foundationPiles = [[],[],[],[]];
        let draggedCards = [], sourcePileInfo = null;

        function dealCards() {
            const deck = [];
            suits.forEach(suit => {
                values.forEach(value => {
                    deck.push({ value, suit, color: (suit === '♥' || suit === '♦') ? 'red' : 'black', faceUp: false });
                });
            });
            deck.sort(() => Math.random() - 0.5);

            tableauPiles = [[],[],[],[],[],[],[]];
            foundationPiles = [[],[],[],[]];
            wastePile = [];

            for (let i = 0; i < 7; i++) {
                for (let j = 0; j <= i; j++) {
                    let card = deck.pop();
                    card.faceUp = (i === j);
                    tableauPiles[i].push(card);
                }
            }
            stockPile = deck;
            renderGame();
        }

        function drawCard() {
            if (stockPile.length === 0) {
                stockPile = wastePile.reverse().map(c => ({ ...c, faceUp: false }));
                wastePile = [];
            } else {
                let card = stockPile.pop();
                card.faceUp = true;
                wastePile.push(card);
            }
            renderGame();
        }

        function handleDrop(destType, destIdx) {
            if (!draggedCards.length) return;
            const firstCard = draggedCards[0];
            let isValid = false;

            if (destType === 'tableau') {
                const targetPile = tableauPiles[destIdx];
                const top = targetPile[targetPile.length - 1];
                if (!top) { if (firstCard.value === 'K') isValid = true; }
                else if (top.faceUp && top.color !== firstCard.color && valueMap[top.value] === valueMap[firstCard.value] + 1) isValid = true;
            } else if (destType === 'foundation' && draggedCards.length === 1) {
                const top = foundationPiles[destIdx][foundationPiles[destIdx].length - 1];
                if (!top) { if (firstCard.value === 'A') isValid = true; }
                else if (top.suit === firstCard.suit && valueMap[firstCard.value] === valueMap[top.value] + 1) isValid = true;
            }

            if (isValid) {
                if (sourcePileInfo.type === 'tableau') {
                    tableauPiles[sourcePileInfo.idx].splice(sourcePileInfo.cardIdx);
                    let prev = tableauPiles[sourcePileInfo.idx];
                    if (prev.length) prev[prev.length - 1].faceUp = true;
                } else if (sourcePileInfo.type === 'waste') wastePile.pop();

                if (destType === 'tableau') tableauPiles[destIdx].push(...draggedCards);
                else foundationPiles[destIdx].push(...draggedCards);
            }
            renderGame();
        }

        function renderGame() {
            const stockEl = document.getElementById('stock-pile');
            stockEl.innerHTML = stockPile.length ? '' : '<span style="position:absolute;top:35%;left:35%;font-size:2rem;opacity:0.2">↺</span>';
            stockEl.className = `card-placeholder ${stockPile.length ? 'card-back' : ''}`;
            stockEl.onclick = drawCard;

            const wasteEl = document.getElementById('waste-pile');
            wasteEl.innerHTML = '';
            if (wastePile.length) {
                const card = wastePile[wastePile.length - 1];
                const cardEl = createCardEl(card);
                cardEl.draggable = true;
                cardEl.ondragstart = () => { draggedCards = [card]; sourcePileInfo = { type: 'waste' }; };
                wasteEl.appendChild(cardEl);
            }

            const fContainer = document.getElementById('foundation-piles');
            fContainer.innerHTML = '';
            foundationPiles.forEach((pile, i) => {
                const fEl = document.createElement('div');
                fEl.className = 'card-placeholder';
                fEl.ondragover = e => e.preventDefault();
                fEl.ondrop = () => handleDrop('foundation', i);
                if (pile.length) fEl.appendChild(createCardEl(pile[pile.length - 1]));
                fContainer.appendChild(fEl);
            });

            tableauPiles.forEach((pile, i) => {
                const pEl = document.getElementById(`pile-${i}`);
                pEl.innerHTML = '';
                pEl.ondragover = e => e.preventDefault();
                pEl.ondrop = () => handleDrop('tableau', i);
                pile.forEach((card, cIdx) => {
                    const cardEl = createCardEl(card);
                    cardEl.style.top = (cIdx * 25) + 'px';
                    if (card.faceUp) {
                        cardEl.draggable = true;
                        cardEl.ondragstart = () => { draggedCards = pile.slice(cIdx); sourcePileInfo = { type: 'tableau', idx: i, cardIdx: cIdx }; };
                    }
                    pEl.appendChild(cardEl);
                });
            });
        }

        function createCardEl(card) {
            const div = document.createElement('div');
            div.className = `card ${card.faceUp ? card.color : 'card-back'}`;
            if (card.faceUp) {
                div.innerHTML = `<div class="card-value">${card.value}</div><div class="card-suit">${card.suit}</div><div class="card-center-suit">${card.suit}</div>`;
            }
            return div;
        }

        document.getElementById('new-game-button').onclick = dealCards;
        dealCards();
    </script>
</body>
</html>
